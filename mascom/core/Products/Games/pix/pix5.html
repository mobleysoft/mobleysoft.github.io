<!DOCTYPE html><html><head><title>TerraVania</title><style>body,canvas{margin:0;padding:0;display:block;background:#000;color:#ffa500;font-family:sans-serif;}canvas{position:absolute;width:100vw;height:100vh;}</style></head><body><canvas id="game"></canvas><script>(()=>{const c=document.getElementById('game'),x=c.getContext('2d'),W=c.width=window.innerWidth,H=c.height=window.innerHeight,R=Math.random,F=()=>Math.floor(R()*255),grid=[],s=6,nx=Math.floor(W/s),ny=Math.floor(H/s);
    const render=()=>{x.clearRect(0,0,W,H);for(let i=0;i<grid.length;i++){let v=grid[i];x.fillStyle=`rgb(${v},${v/1.5},${v/6})`;x.fillRect((i%nx)*s,Math.floor(i/nx)*s,s,s);}};
    const step=()=>{let next=grid.slice();for(let i=0;i<grid.length;i++){let n=0,px=i%nx,py=Math.floor(i/nx);for(let dx=-1;dx<=1;dx++)for(let dy=-1;dy<=1;dy++){if(dx||dy){let ni=(px+dx+nx)%nx+((py+dy+ny)%ny)*nx;n+=grid[ni]>127?1:0;}}next[i]=(grid[i]>127?n>=2&&n<=4:n===3)?255:0;}grid.splice(0,grid.length,...next);render();};
    const loop=()=>{step();requestAnimationFrame(loop);};
    for(let i=0;i<nx*ny;i++)grid.push(R()>0.35?255:0);
    const addPlayer=(()=>{const player={x:nx/2,y:ny/2,color:"#00ff00",size:2,health:3,scoreMultiplier:1};const drawPlayer=()=>{x.fillStyle=player.color;x.fillRect(player.x*s,player.y*s,player.size*s,player.size*s);};const movePlayer=(dx,dy)=>{player.x=Math.max(0,Math.min(nx-1,player.x+dx));player.y=Math.max(0,Math.min(ny-1,player.y+dy));};const takeDamage=()=>{player.health--;if(player.health<=0)console.log('Game Over');};const heal=()=>{player.health++;console.log('Health Restored:',player.health);};const increaseMultiplier=()=>{player.scoreMultiplier++;console.log('Multiplier Increased:',player.scoreMultiplier);};return{draw:drawPlayer,move:movePlayer,damage:takeDamage,heal:heal,increaseMultiplier:increaseMultiplier,info:player};})();
    const handleInput=(()=>{const keys={};let speed=1;window.onkeydown=e=>keys[e.key]=true;window.onkeyup=e=>keys[e.key]=false;const updatePlayerMovement=()=>{if(keys['ArrowUp'])addPlayer.move(0,-1*speed);if(keys['ArrowDown'])addPlayer.move(0,1*speed);if(keys['ArrowLeft'])addPlayer.move(-1*speed,0);if(keys['ArrowRight'])addPlayer.move(1*speed,0);};const speedBoost=()=>{speed=2;setTimeout(()=>speed=1,5000);};return{update:updatePlayerMovement,speedBoost:speedBoost};})();
    const addEnemies=(()=>{const enemies=[];for(let i=0;i<10;i++)enemies.push({x:Math.floor(R()*nx),y:Math.floor(R()*ny),color:"#ff0000",size:2});const drawEnemies=()=>{enemies.forEach(e=>{x.fillStyle=e.color;x.fillRect(e.x*s,e.y*s,e.size*s,e.size*s);});};const moveEnemies=()=>{enemies.forEach(e=>{e.x=(e.x+Math.floor(R()*3)-1+nx)%nx;e.y=(e.y+Math.floor(R()*3)-1+ny)%ny;});};const attackPlayer=()=>{enemies.forEach(e=>{if(Math.abs(e.x-addPlayer.info.x)<2&&Math.abs(e.y-addPlayer.info.y)<2){addPlayer.damage();console.log('Enemy Attack! Health:',addPlayer.info.health);}});};return{draw:drawEnemies,move:moveEnemies,attack:attackPlayer,enemies};})();
    const checkCollisions=(()=>{const check=()=>{addEnemies.attack();};return{update:check};})();
    const addTreasures=(()=>{const treasures=[];for(let i=0;i<5;i++)treasures.push({x:Math.floor(R()*nx),y:Math.floor(R()*ny),color:"#ffff00",size:1});const drawTreasures=()=>{treasures.forEach(t=>{x.fillStyle=t.color;x.fillRect(t.x*s,t.y*s,t.size*s,t.size*s);});};const collectTreasures=()=>{treasures.forEach((t,i)=>{if(Math.abs(t.x-addPlayer.info.x)<2&&Math.abs(t.y-addPlayer.info.y)<2){treasures.splice(i,1);addScore.add(10*addPlayer.info.scoreMultiplier);console.log('Treasure Collected!');}});};return{draw:drawTreasures,collect:collectTreasures,treasures};})();
    const addHealthPacks=(()=>{const healthPacks=[];for(let i=0;i<2;i++)healthPacks.push({x:Math.floor(R()*nx),y:Math.floor(R()*ny),color:"#00ffff",size:1});const drawHealthPacks=()=>{healthPacks.forEach(h=>{x.fillStyle=h.color;x.fillRect(h.x*s,h.y*s,h.size*s,h.size*s);});};const collectHealthPacks=()=>{healthPacks.forEach((h,i)=>{if(Math.abs(h.x-addPlayer.info.x)<2&&Math.abs(h.y-addPlayer.info.y)<2){healthPacks.splice(i,1);addPlayer.heal();console.log('Health Pack Collected!');}});};return{draw:drawHealthPacks,collect:collectHealthPacks,healthPacks};})();
    const addScore=(()=>{let score=0;const increment=(points)=>{score+=points;console.log('Score:',score);};const drawScore=()=>{x.fillStyle="#fff";x.font="16px Arial";x.fillText(`Score: ${score}`,10,20);};return{add:increment,draw:drawScore};})();
    const addLevels=(()=>{let level=1;const nextLevel=()=>{level++;addEnemies.enemies.push(...Array.from({length:5},()=>({x:Math.floor(R()*nx),y:Math.floor(R()*ny),color:"#ff0000",size:2})));addPlayer.increaseMultiplier();console.log('Level Up! Current Level:',level);};const drawLevel=()=>{x.fillStyle="#fff";x.font="16px Arial";x.fillText(`Level: ${level}`,10,40);};return{next:nextLevel,draw:drawLevel,info:()=>level};})();
    const addHazards=(()=>{const hazards=[];for(let i=0;i<10;i++)hazards.push({x:Math.floor(R()*nx),y:Math.floor(R()*ny),color:"#ff6600",size:1});const drawHazards=()=>{hazards.forEach(h=>{x.fillStyle=h.color;x.fillRect(h.x*s,h.y*s,h.size*s,h.size*s);});};const checkHazardDamage=()=>{hazards.forEach(h=>{if(Math.abs(h.x-addPlayer.info.x)<2&&Math.abs(h.y-addPlayer.info.y)<2){addPlayer.damage();console.log('Hazard Damage! Health:',addPlayer.info.health);}});};return{draw:drawHazards,damage:checkHazardDamage};})();
    const addBoss=(()=>{let boss=null;const spawnBoss=()=>{boss={x:nx/2,y:ny/2,color:"#800080",size:4,health:10};console.log('Boss Spawned!');};const drawBoss=()=>{if(boss){x.fillStyle=boss.color;x.fillRect(boss.x*s,boss.y*s,boss.size*s,boss.size*s);}};const attackBoss=()=>{if(boss&&Math.abs(boss.x-addPlayer.info.x)<3&&Math.abs(boss.y-addPlayer.info.y)<3){boss.health--;console.log('Boss Hit! Health:',boss.health);if(boss.health<=0){console.log('Boss Defeated!');boss=null;}}};return{spawn:spawnBoss,draw:drawBoss,attack:attackBoss,bossInfo:()=>boss};})();
    const addPowerUps=(()=>{const powerUps=[];for(let i=0;i<2;i++)powerUps.push({x:Math.floor(R()*nx),y:Math.floor(R()*ny),color:"#ff00ff",size:1,effect:"speed"});const drawPowerUps=()=>{powerUps.forEach(p=>{x.fillStyle=p.color;x.fillRect(p.x*s,p.y*s,p.size*s,p.size*s);});};const collectPowerUps=()=>{powerUps.forEach((p,i)=>{if(Math.abs(p.x-addPlayer.info.x)<2&&Math.abs(p.y-addPlayer.info.y)<2){powerUps.splice(i,1);console.log('Power-Up Collected:',p.effect);if(p.effect==="speed")handleInput.speedBoost();}});};return{draw:drawPowerUps,collect:collectPowerUps,powerUps};})();
    const gameLoop=()=>{step();handleInput.update();addEnemies.move();addEnemies.draw();addEnemies.attack();addPlayer.draw();addTreasures.draw();addTreasures.collect();addHealthPacks.draw();addHealthPacks.collect();addPowerUps.draw();addPowerUps.collect();addHazards.draw();addHazards.damage();if(addBoss.bossInfo()){addBoss.draw();addBoss.attack();}else if(addLevels.info()%5===0)addBoss.spawn();addScore.draw();addLevels.draw();if(addTreasures.treasures.length===0)addLevels.next();requestAnimationFrame(gameLoop);};
    loop();gameLoop();})();</script></body></html>
    